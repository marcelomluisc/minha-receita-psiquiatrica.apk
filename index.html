<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dr. Marcelo Medeiros - App Psiqui√°trico</title>
    
    <!-- ==================== -->
    <!-- PWA CONFIGURA√á√ïES -->
    <!-- ==================== -->
    <link rel="manifest" href="/minha-receita-psiquiatrica.apk/manifest.json">
    <meta name="theme-color" content="#0d9488"/>
    
    <!-- √çcone para navegadores desktop/mobile -->
    <link rel="icon" type="image/png" href="https://i.ibb.co/CsTtFZ52/FOTO-AAAAA.png">
    <link rel="shortcut icon" href="https://i.ibb.co/CsTtFZ52/FOTO-AAAAA.png" type="image/png">
    
    <!-- Apple iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Anamnese Psiqui√°trica">
    <link rel="apple-touch-icon" href="https://i.ibb.co/CsTtFZ52/FOTO-AAAAA.png">
    <link rel="apple-touch-startup-image" href="https://i.ibb.co/CsTtFZ52/FOTO-AAAAA.png">
    
    <!-- Windows -->
    <meta name="msapplication-TileImage" content="https://i.ibb.co/CsTtFZ52/FOTO-AAAAA.png">
    <meta name="msapplication-TileColor" content="#0d9488">
    
    <!-- Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Anamnese Psiqui√°trica">
    
    <!-- ==================== -->
    <!-- STYLES E SCRIPTS -->
    <!-- ==================== -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --whatsapp-green: #25d366;
            --teal-primary: #0d9488;
            --dark-teal: #0f766e;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Inter', sans-serif; 
            line-height: 1.6; 
            color: #333;
            background: #f7f9fb;
            padding-bottom: 30px;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* WhatsApp Flutuante */
        .whatsapp-float {
            position: fixed;
            width: 70px;
            height: 70px;
            bottom: 25px;
            right: 25px;
            background-color: var(--whatsapp-green);
            color: #FFF;
            border-radius: 50px;
            text-align: center;
            font-size: 35px;
            box-shadow: 0 4px 20px rgba(37, 211, 102, 0.4);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            transition: all 0.3s;
        }
        .whatsapp-float:hover { 
            background-color: #128C7E;
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(37, 211, 102, 0.6);
        }
        
        /* Cabe√ßalho */
        .app-header {
            background: white;
            padding: 20px 0;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
            border-bottom: 3px solid var(--teal-primary);
        }
        
        .doctor-photo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--teal-primary);
            box-shadow: 0 5px 15px rgba(13, 148, 136, 0.2);
        }
        
        /* Bot√£o WhatsApp */
        .whatsapp-btn {
            background: linear-gradient(135deg, var(--whatsapp-green), #128C7E);
            color: white;
            padding: 14px 35px;
            border-radius: 50px;
            font-weight: 700;
            font-size: 1.1rem;
            border: none;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
            box-shadow: 0 5px 15px rgba(37, 211, 102, 0.3);
        }
        .whatsapp-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(37, 211, 102, 0.5);
            color: white;
        }
        
        /* Servi√ßos */
        .service-card {
            border: 2px solid #e5e7eb;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s;
            height: 100%;
            background: white;
            margin-bottom: 20px;
            cursor: pointer;
        }
        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(13, 148, 136, 0.15);
            border-color: var(--teal-primary);
        }
        
        .price-tag {
            font-size: 2.8rem;
            font-weight: 900;
            color: var(--dark-teal);
            margin: 15px 0;
        }
        
        /* Badge */
        .badge-credencial {
            background: linear-gradient(135deg, var(--teal-primary), var(--dark-teal));
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
        }
        
        /* Container do Formul√°rio */
        #form-container {
            min-height: 500px;
            margin: 30px 0;
        }
        
        /* Estilos do Formul√°rio */
        .form-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            margin: 30px 0;
        }
        
        /* Modal de Termos */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        /* Estilos do formul√°rio */
        .form-step {
            display: none;
        }
        
        .form-step.active {
            display: block;
        }
        
        .form-label {
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
            display: block;
        }
        
        .form-control, .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 20px;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--teal-primary);
            outline: none;
        }
        
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
            margin: 20px 0;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background: #f8fafc;
            border-radius: 8px;
            border: 2px solid #e5e7eb;
        }
        
        .checkbox-item input {
            margin-right: 10px;
            transform: scale(1.2);
        }
        
        .button-group {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            gap: 15px;
        }
        
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
        }
        
        .btn-back {
            background: #f3f4f6;
            color: #4b5563;
        }
        
        .btn-back:hover {
            background: #e5e7eb;
        }
        
        .btn-next {
            background: var(--teal-primary);
            color: white;
        }
        
        .btn-next:hover {
            background: var(--dark-teal);
        }
        
        .btn-whatsapp {
            background: var(--whatsapp-green) !important;
            color: white !important;
        }
        
        .btn-whatsapp:hover {
            background: #128C7E !important;
        }
        
        .progress-container {
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: var(--teal-primary);
            transition: width 0.3s;
        }
        
        .step-indicator {
            text-align: center;
            color: #6b7280;
            margin-bottom: 30px;
            font-weight: 600;
        }
        
        /* Alertas */
        .alert {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid;
        }
        
        .alert-info {
            background: #f0f9ff;
            border-color: var(--teal-primary);
        }
        
        .alert-warning {
            background: #fef3c7;
            border-color: #d97706;
        }
        
        .alert-danger {
            background: #fef2f2;
            border-color: #dc2626;
        }

        /* Resumo do Pedido */
        .order-summary {
            background: #f8fafc;
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
            border: 2px solid #e5e7eb;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .summary-total {
            display: flex;
            justify-content: space-between;
            padding: 18px 0;
            font-size: 1.3rem;
            font-weight: 800;
            color: var(--dark-teal);
        }

        .required-field::after {
            content: " *";
            color: #dc2626;
        }
        
        .validation-error {
            color: #dc2626;
            font-size: 0.875rem;
            margin-top: -15px;
            margin-bottom: 15px;
            display: none;
        }
        
        .field-invalid {
            border-color: #dc2626 !important;
        }
        
        .whatsapp-loading {
            display: none;
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: #f0f9ff;
            border-radius: 10px;
            border-left: 4px solid var(--whatsapp-green);
        }
        
        .whatsapp-fallback {
            display: none;
            margin-top: 20px;
        }
        
        /* Instala√ß√£o PWA */
        .pwa-install-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 15px;
            box-shadow: 0 -2px 20px rgba(0,0,0,0.1);
            z-index: 999;
            display: none;
            border-top: 3px solid var(--teal-primary);
        }
        
        .pwa-close {
            position: absolute;
            right: 10px;
            top: 10px;
            background: none;
            border: none;
            font-size: 1.2rem;
            color: #6b7280;
            cursor: pointer;
        }
        
        /* PWA Install Button */
        .install-app-btn {
            background: linear-gradient(135deg, var(--teal-primary), var(--dark-teal));
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        /* Splash Screen para PWA */
        .app-splash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--teal-primary), var(--dark-teal));
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s;
        }
        
        .splash-logo {
            width: 150px;
            height: 150px;
            border-radius: 30px;
            object-fit: cover;
            border: 5px solid white;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }
        
        .splash-text {
            color: white;
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            margin-top: 20px;
        }
        
        /* Fallback para splash screen */
        .splash-error {
            display: none;
            text-align: center;
            color: white;
            margin-top: 20px;
        }

        .splash-error button {
            background: white;
            color: var(--teal-primary);
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            margin-top: 10px;
            font-weight: bold;
            cursor: pointer;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* Ajustes para PWA instalado */
        .standalone-mode .whatsapp-float {
            bottom: 90px; /* Mais alto para n√£o cobrir bot√µes do PWA */
        }
        
        /* Ajustes mobile */
        @media (max-width: 768px) {
            .pwa-install-banner {
                padding: 12px;
            }
            
            .install-app-btn {
                padding: 12px 24px;
                font-size: 0.95rem;
            }
            
            .doctor-photo {
                width: 100px;
                height: 100px;
            }
            
            .whatsapp-float {
                width: 60px;
                height: 60px;
                font-size: 30px;
            }
        }
    </style>
</head>
<body>
    <!-- Splash Screen para PWA -->
    <div class="app-splash" id="splashScreen">
        <img src="https://i.ibb.co/CsTtFZ52/FOTO-AAAAA.png" 
             alt="Dr. Marcelo Medeiros"
             class="splash-logo"
             onerror="this.src='https://via.placeholder.com/150/0d9488/ffffff?text=Dr.Marcelo'">
        <div class="spinner-border text-white" style="width: 3rem; height: 3rem;" role="status">
            <span class="visually-hidden">Carregando...</span>
        </div>
        <div class="splash-text">Dr. Marcelo Medeiros<br>Anamnese Psiqui√°trica</div>
        
        <!-- Fallback para splash screen -->
        <div class="splash-error" id="splashError">
            <p>Carregamento demorado...</p>
            <button onclick="hideSplash()">Continuar</button>
        </div>
    </div>
    
    <!-- Banner de Instala√ß√£o PWA -->
    <div class="pwa-install-banner" id="installBanner">
        <button class="pwa-close" onclick="hideInstallBanner()">√ó</button>
        <div class="d-flex align-items-center">
            <img src="https://i.ibb.co/CsTtFZ52/FOTO-AAAAA.png" 
                 alt="√çcone do App"
                 style="width: 50px; height: 50px; border-radius: 10px; margin-right: 15px; border: 2px solid var(--teal-primary);"
                 onerror="this.src='https://via.placeholder.com/50/0d9488/ffffff?text=Dr.M'">
            <div>
                <h6 class="mb-1 fw-bold">Instalar App de Anamnese</h6>
                <p class="mb-2 small text-muted">Funciona offline como aplicativo nativo</p>
                <button class="install-app-btn" onclick="installPWA()">
                    <i class="fas fa-download"></i> Instalar App
                </button>
            </div>
        </div>
    </div>

    <!-- WhatsApp Flutuante -->
    <a href="https://wa.me/554491339060?text=Ol√°,%20Dr.%20Marcelo,%20gostaria%20de%20agendar%20uma%20consulta%20online%20de%2030%20minutos%20(R$%2099,90)" 
       class="whatsapp-float" target="_blank" title="Agende pelo WhatsApp">
       <i class="fab fa-whatsapp"></i>
    </a>

    <!-- Cabe√ßalho com sua foto -->
    <header class="app-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-3 text-center">
                    <img src="https://i.ibb.co/CsTtFZ52/FOTO-AAAAA.png" 
                         class="doctor-photo" 
                         alt="Dr. Marcelo Medeiros"
                         onerror="this.src='https://via.placeholder.com/150/0d9488/ffffff?text=Dr.Marcelo'">
                </div>
                <div class="col-md-6">
                    <h1 class="h3 fw-900 mb-2" style="color: var(--dark-teal);">
                        Dr. Marcelo Medeiros
                    </h1>
                    <p class="mb-1 fw-600" style="color: #4b5563;">
                        Psiquiatria Online | CRM 47960
                    </p>
                    <p class="mb-0 small text-muted">
                        P√≥s-gradua√ß√£o em Psiquiatria pelo Hospital Albert Einstein
                    </p>
                    <div class="mt-2">
                        <span class="badge-credencial me-2">CRM 47960</span>
                        <span class="badge-credencial">Atendimento Online</span>
                    </div>
                </div>
                <div class="col-md-3 text-end">
                    <a href="https://wa.me/554491339060?text=Ol√°,%20Dr.%20Marcelo,%20gostaria%20de%20agendar%20uma%20consulta%20online%20de%2030%20minutos%20(R$%2099,90)" 
                       class="whatsapp-btn" target="_blank">
                        <i class="fab fa-whatsapp me-2"></i> Agendar
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Se√ß√£o de Servi√ßos -->
    <section class="py-5">
        <div class="container">
            <h2 class="text-center h2 fw-900 mb-5" style="color: var(--dark-teal);">
                Servi√ßos Psiqui√°tricos
            </h2>
            
            <div class="row">
                <div class="col-md-4">
                    <div class="service-card" onclick="selectService('consulta')">
                        <i class="fas fa-video fa-3x mb-3" style="color: var(--teal-primary);"></i>
                        <h3 class="h5 fw-800 mb-3">Consulta Online</h3>
                        <div class="price-tag">R$ 99,90</div>
                        <p class="text-muted mb-3">
                            <i class="fas fa-clock me-1"></i> 30 minutos por videochamada<br>
                            <i class="fas fa-stethoscope me-1"></i> Diagn√≥stico especializado<br>
                            <i class="fas fa-file-medical me-1"></i> Acompanhamento completo
                        </p>
                        <button class="whatsapp-btn" style="padding: 10px 25px; font-size: 0.9rem;">
                            Selecionar
                        </button>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="service-card" onclick="selectService('laudoSemRQE')">
                        <i class="fas fa-file-contract fa-3x mb-3" style="color: var(--teal-primary);"></i>
                        <h3 class="h5 fw-800 mb-3">Laudo sem RQE + Consulta</h3>
                        <div class="price-tag">R$ 180,00</div>
                        <p class="text-muted mb-3">
                            <i class="fas fa-certificate me-1"></i> Laudo sem RQE + Consulta Online<br>
                            <i class="fas fa-clipboard-check me-1"></i> Elabora√ß√£o detalhada<br>
                            <i class="fas fa-shield-alt me-1"></i> Documento oficial
                        </p>
                        <button class="whatsapp-btn" style="padding: 10px 25px; font-size: 0.9rem;">
                            Selecionar
                        </button>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="service-card" onclick="selectService('laudoComRQE')">
                        <i class="fas fa-file-signature fa-3x mb-3" style="color: var(--teal-primary);"></i>
                        <h3 class="h5 fw-800 mb-3">Laudo com RQE</h3>
                        <div class="price-tag">R$ 250,00</div>
                        <p class="text-muted mb-3">
                            <i class="fas fa-award me-1"></i> Com Registro de Qualifica√ß√£o<br>
                            <i class="fas fa-search me-1"></i> Avalia√ß√£o completa<br>
                            <i class="fas fa-gavel me-1"></i> Para fins legais
                        </p>
                        <button class="whatsapp-btn" style="padding: 10px 25px; font-size: 0.9rem;">
                            Selecionar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- FORMUL√ÅRIO DE ANAMNESE -->
    <section class="py-4">
        <div class="container">
            <div class="form-container">
                <h2 class="text-center h3 fw-900 mb-4" style="color: var(--dark-teal);">
                    üìã Formul√°rio de Anamnese Psiqui√°trica
                </h2>
                
                <div id="form-container">
                    <!-- Formul√°rio ser√° injetado aqui pelo JavaScript -->
                    <div class="text-center text-muted" id="form-placeholder">
                        <i class="fas fa-clipboard-list fa-3x mb-3" style="color: #d1d5db;"></i>
                        <p>Selecione um servi√ßo acima para iniciar o formul√°rio</p>
                        <p class="small"><i class="fas fa-exclamation-circle me-1"></i> Todos os campos marcados com * s√£o obrigat√≥rios</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Instru√ß√µes -->
    <section class="py-5 bg-light">
        <div class="container text-center">
            <h3 class="h4 fw-800 mb-4" style="color: var(--dark-teal);">
                ‚ö†Ô∏è Instru√ß√µes Importantes
            </h3>
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <div class="alert alert-info">
                        <p class="mb-2"><strong>1.</strong> Selecione o servi√ßo desejado acima</p>
                        <p class="mb-2"><strong>2.</strong> Preencha <strong>TODOS</strong> os campos obrigat√≥rios da anamnese (*)</p>
                        <p class="mb-2"><strong>3.</strong> Ao final, clique no bot√£o do WhatsApp para enviar</p>
                        <p class="mb-0"><strong>4.</strong> Eu enviarei os dados para pagamento (PIX/Stripe) via WhatsApp</p>
                    </div>
                    <div class="alert alert-warning">
                        <p class="mb-0"><strong>‚ö†Ô∏è ATEN√á√ÉO:</strong> O formul√°rio completo √© OBRIGAT√ìRIO para agendamento</p>
                    </div>
                    <a href="https://wa.me/554491339060?text=Ol√°,%20Dr.%20Marcelo,%20tenho%20d√∫vidas%20sobre%20as%20consultas%20online" 
                       class="whatsapp-btn mt-3" target="_blank">
                        <i class="fab fa-whatsapp me-2"></i> Tirar D√∫vidas
                    </a>
                    
                    <!-- Bot√£o de Instala√ß√£o PWA -->
                    <div class="mt-4">
                        <button onclick="showInstallInstructions()" class="btn" style="background: #f0f9ff; border: 2px solid var(--teal-primary); color: var(--dark-teal);">
                            <i class="fas fa-mobile-alt me-2"></i> Como instalar este app no celular
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Rodap√© -->
    <footer class="bg-dark text-white py-4">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h3 class="h5 fw-900 mb-2">Dr. Marcelo Medeiros</h3>
                    <p class="small text-white-50 mb-0">
                        Atendimento online conforme resolu√ß√µes do CFM e C√≥digo de √âtica M√©dica
                    </p>
                </div>
                <div class="col-md-4 text-md-end">
                    <a href="mailto:marcelomedeirossaudeefitness@gmail.com" 
                       class="text-white d-block mb-1 small">
                        <i class="fas fa-envelope me-1"></i> E-mail profissional
                    </a>
                    <a href="https://wa.me/554491339060" 
                       class="text-white d-block small">
                        <i class="fab fa-whatsapp me-1"></i> WhatsApp para d√∫vidas
                    </a>
                </div>
            </div>
            <hr class="my-3 opacity-25">
            <p class="text-center small text-white-50 mb-0">
                <i class="fas fa-exclamation-triangle me-1"></i> 
                Para emerg√™ncias, procure um pronto-socorro ou ligue 188 (CVV)
            </p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // =============================
        // DIAGN√ìSTICO INICIAL
        // =============================
        console.log('üöÄ App iniciando...');
        console.log('URL:', window.location.href);
        console.log('Service Worker:', 'serviceWorker' in navigator);

        // Monitorar erros
        window.addEventListener('error', function(e) {
            console.error('‚ùå Erro global:', e.error);
            console.error('‚ùå Em:', e.filename, 'linha', e.lineno);
        });

        // =============================
        // FUN√á√ïES GERAIS
        // =============================
        function hideSplash() {
            const splash = document.getElementById('splashScreen');
            if (splash) {
                splash.style.opacity = '0';
                setTimeout(() => {
                    splash.style.display = 'none';
                }, 500);
            }
        }

        // =============================
        // REGISTRAR SERVICE WORKER COM TRY-CATCH
        // =============================
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // Verifica se estamos na URL correta
                const swPath = '/minha-receita-psiquiatrica.apk/sw.js';
                const currentPath = window.location.pathname;
                
                console.log('üìç Registrando Service Worker...');
                console.log('üìÅ Caminho atual:', currentPath);
                console.log('üìÅ Caminho SW:', swPath);
                
                navigator.serviceWorker.register(swPath)
                    .then(registration => {
                        console.log('‚úÖ Service Worker registrado com sucesso!');
                        console.log('üîß Scope:', registration.scope);
                        console.log('üöÄ Estado:', registration.active ? 'Ativo' : 'Inativo');
                        
                        // For√ßar atualiza√ß√£o
                        registration.update();
                        
                        // Verificar se h√° uma nova vers√£o
                        registration.addEventListener('updatefound', () => {
                            console.log('üîÑ Nova vers√£o do Service Worker encontrada!');
                            const newWorker = registration.installing;
                            
                            newWorker.addEventListener('statechange', () => {
                                console.log('üìä Estado do novo worker:', newWorker.state);
                                
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('üÜï Nova vers√£o pronta! Recarregando...');
                                    window.location.reload();
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.log('‚ùå Falha ao registrar Service Worker:', error);
                        console.log('üîß Dica: Verifique se o arquivo sw.js existe em:', swPath);
                        
                        // Continuar sem Service Worker se falhar
                        hideSplash();
                    });
            });
        }
        
        // =============================
        // CONFIGURA√á√ïES PWA
        // =============================
        let deferredPrompt;
        let isStandalone = window.matchMedia('(display-mode: standalone)').matches || 
                          window.navigator.standalone === true;
        
        // Controlador do splash screen
        window.addEventListener('load', function() {
            const splash = document.getElementById('splashScreen');
            
            // Verificar se tudo carregou corretamente
            Promise.all([
                // Verificar se imagens carregaram
                new Promise(resolve => {
                    const img = new Image();
                    img.src = 'https://i.ibb.co/CsTtFZ52/FOTO-AAAAA.png';
                    img.onload = resolve;
                    img.onerror = resolve; // Continua mesmo com erro
                }),
                // Esperar fonts carregarem
                document.fonts.ready || Promise.resolve()
            ]).then(() => {
                // Esconder splash ap√≥s tudo carregar
                if (splash) {
                    setTimeout(() => {
                        splash.style.opacity = '0';
                        setTimeout(() => {
                            splash.style.display = 'none';
                        }, 500);
                    }, 1000); // Reduzido de 1.5s para 1s
                }
                
                // Mostrar banner de instala√ß√£o se n√£o estiver instalado
                if (!isStandalone) {
                    setTimeout(() => {
                        showInstallBanner();
                    }, 2000);
                }
            }).catch(() => {
                // Fallback: esconder ap√≥s 2 segundos mesmo com erro
                setTimeout(() => {
                    if (splash) {
                        splash.style.opacity = '0';
                        setTimeout(() => {
                            splash.style.display = 'none';
                        }, 500);
                    }
                }, 2000);
            });
        });

        // Timeout de seguran√ßa para splash screen
        setTimeout(() => {
            const splash = document.getElementById('splashScreen');
            const errorMsg = document.getElementById('splashError');
            if (splash && splash.style.display !== 'none') {
                if (errorMsg) errorMsg.style.display = 'block';
                // Auto-hide ap√≥s 8 segundos
                setTimeout(hideSplash, 8000);
            }
        }, 5000);

        // Detectar evento de instala√ß√£o PWA
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            console.log('üì± PWA: Evento de instala√ß√£o detectado');
            
            // Mostrar banner ap√≥s 3 segundos
            setTimeout(() => {
                showInstallBanner();
            }, 3000);
        });
        
        // Fun√ß√£o para instalar PWA
        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('‚úÖ Usu√°rio aceitou instalar o PWA');
                        hideInstallBanner();
                    }
                    deferredPrompt = null;
                });
            } else {
                // Fallback: mostrar instru√ß√µes
                showInstallInstructions();
            }
        }
        
        // Mostrar banner de instala√ß√£o
        function showInstallBanner() {
            if (!isStandalone) {
                const banner = document.getElementById('installBanner');
                if (banner) {
                    banner.style.display = 'block';
                    console.log('üì± PWA: Mostrando banner de instala√ß√£o');
                }
            }
        }
        
        // Esconder banner de instala√ß√£o
        function hideInstallBanner() {
            const banner = document.getElementById('installBanner');
            if (banner) {
                banner.style.display = 'none';
            }
        }
        
        // Mostrar instru√ß√µes de instala√ß√£o
        function showInstallInstructions() {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            const isAndroid = /android/i.test(navigator.userAgent);
            
            let message = '';
            let icon = 'üì±';
            
            if (isIOS) {
                message = `${icon} *iPhone/iPad:*

1. Toque no √≠cone de compartilhar (üì§) na barra do Safari
2. Role para baixo no menu
3. Toque em "Adicionar √† tela de in√≠cio"
4. Toque "Adicionar" no canto superior direito

‚úÖ O app aparecer√° na sua tela inicial como um aplicativo normal!`;
                icon = 'üì±';
            } else if (isAndroid) {
                message = `${icon} *Android:*

1. Toque nos 3 pontos (‚ãÆ) no canto superior do Chrome
2. Selecione "Adicionar √† tela inicial"
3. Toque em "Adicionar"
4. Confirme se deseja instalar

‚úÖ O √≠cone do app ser√° adicionado √† sua √°rea de trabalho!`;
                icon = 'ü§ñ';
            } else {
                message = `${icon} *Computador:*

No *Chrome/Edge:*
1. Clique no √≠cone de instala√ß√£o (üì•) na barra de endere√ßos
2. Clique em "Instalar"

No *Safari:*
1. Arquivo ‚Üí "Adicionar √† tela de in√≠cio"

‚úÖ O app ser√° instalado como um aplicativo desktop!`;
                icon = 'üíª';
            }
            
            // Criar modal bonito
            const modalHtml = `
                <div class="modal-overlay" id="installModal">
                    <div class="modal-content">
                        <div class="text-center mb-4">
                            <div style="font-size: 3rem; margin-bottom: 15px;">${icon}</div>
                            <h2 class="h4 fw-bold" style="color: #374151;">Como Instalar o App</h2>
                            <p class="text-muted">Siga os passos para adicionar √† sua √°rea de trabalho</p>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px; white-space: pre-line; text-align: left; font-size: 0.95rem;">
                            ${message}
                        </div>
                        
                        <button onclick="document.getElementById('installModal').remove()" class="btn w-100" style="background: #0d9488; color: white; padding: 12px; font-weight: bold; border-radius: 10px;">
                            Entendi, Obrigado!
                        </button>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }
        
        // Detectar se est√° em modo standalone (j√° instalado)
        if (isStandalone) {
            console.log('‚úÖ App rodando em modo standalone (instalado)');
            document.body.classList.add('standalone-mode');
        }
        
        // =============================
        // DADOS DO APP
        // =============================
        let selectedService = null;
        let currentStep = 1;
        const totalSteps = 5;
        
        // SERVICOS ATUALIZADOS
        const services = {
            consulta: {
                id: 'consulta',
                nome: 'Consulta Online (30min)',
                valor: '99,90',
                descricao: 'Videochamada + diagn√≥stico'
            },
            laudoSemRQE: {
                id: 'laudoSemRQE',
                nome: 'Laudo sem RQE + Consulta',
                valor: '180,00',
                descricao: 'Laudo sem RQE + Consulta Online'
            },
            laudoComRQE: {
                id: 'laudoComRQE',
                nome: 'Laudo com RQE',
                valor: '250,00',
                descricao: 'Com registro de qualifica√ß√£o'
            }
        };

        // Dados do formul√°rio
        let formData = {
            nome: '',
            idade: '',
            telefone: '',
            email: '',
            servico: '',
            estadoAtual: '',
            estabilidadeTratamento: '',
            sintomasAnsiosos: [],
            sintomasDepressivos: [],
            sintomasHumor: [],
            pensamentosMorte: '',
            percepRealidade: '',
            queixaPrincipal: '',
            historicoPsiquiatrico: '',
            medicacaoAtual: '',
            comorbidades: ''
        };

        // Listas para checkboxes
        const sintomasAnsiososList = [
            'Preocupa√ß√£o excessiva',
            'Tens√£o muscular',
            'Dificuldade de relaxar',
            'Ins√¥nia',
            'Irritabilidade',
            'Falta de ar',
            'Palpita√ß√µes',
            'Sudorese',
            'Tremores',
            'Medos irracionais'
        ];

        const sintomasDepressivosList = [
            'Tristeza persistente',
            'Perda de interesse',
            'Fadiga constante',
            'Altera√ß√µes de apetite',
            'Altera√ß√µes de sono',
            'Dificuldade de concentra√ß√£o',
            'Sentimentos de culpa',
            'Agita√ß√£o ou lentid√£o',
            'Pensamentos de morte',
            'Choro frequente'
        ];

        const sintomasHumorList = [
            'Euforia',
            'Irritabilidade',
            'Acelera√ß√£o pensamento',
            'Redu√ß√£o necessidade sono',
            'Grandiosidade',
            'Aumento atividade',
            'Comportamentos impulsivos',
            'Distraibilidade',
            'Agita√ß√£o psicomotora',
            'Hiperatividade sexual'
        ];

        // =============================
        // FUN√á√ïES DO FORMUL√ÅRIO
        // =============================
        function selectService(serviceId) {
            selectedService = services[serviceId];
            formData.servico = selectedService.nome;
            
            // Remover placeholder
            const placeholder = document.getElementById('form-placeholder');
            if (placeholder) {
                placeholder.style.display = 'none';
            }
            
            // Injetar formul√°rio
            document.getElementById('form-container').innerHTML = generateForm();
            
            // Iniciar no passo 1
            showStep(1);
            
            // Scroll para formul√°rio
            document.getElementById('form-container').scrollIntoView({ behavior: 'smooth' });
            
            console.log('‚úÖ Servi√ßo selecionado:', selectedService.nome);
        }

        function generateForm() {
            return `
                <div class="progress-container">
                    <div class="progress-bar" id="progressBar" style="width: ${(1/totalSteps)*100}%"></div>
                </div>
                
                <div class="step-indicator" id="stepIndicator">
                    Passo 1 de ${totalSteps}
                </div>
                
                <!-- Passo 1: Dados Pessoais -->
                <div class="form-step active" id="step1">
                    <h4 class="mb-4" style="color: var(--dark-teal);">üìù Dados Pessoais</h4>
                    
                    <label class="form-label required-field">Nome Completo</label>
                    <input type="text" class="form-control" id="nome" placeholder="Digite seu nome completo" required>
                    <div class="validation-error" id="nomeError">Nome √© obrigat√≥rio</div>
                    
                    <label class="form-label required-field">Idade</label>
                    <input type="number" class="form-control" id="idade" placeholder="Digite sua idade" min="1" max="120" required>
                    <div class="validation-error" id="idadeError">Idade √© obrigat√≥ria</div>
                    
                    <label class="form-label required-field">Telefone com WhatsApp</label>
                    <input type="tel" class="form-control" id="telefone" placeholder="(XX) XXXXX-XXXX" required>
                    <div class="validation-error" id="telefoneError">Telefone √© obrigat√≥rio</div>
                    
                    <label class="form-label required-field">E-mail</label>
                    <input type="email" class="form-control" id="email" placeholder="seu.email@exemplo.com" required>
                    <div class="validation-error" id="emailError">E-mail √© obrigat√≥rio</div>
                    
                    <div class="button-group">
                        <button class="btn btn-back" disabled>Voltar</button>
                        <button class="btn btn-next" onclick="validateStep1()">Pr√≥ximo</button>
                    </div>
                </div>
                
                <!-- Passo 2: Estado Atual -->
                <div class="form-step" id="step2">
                    <h4 class="mb-4" style="color: var(--dark-teal);">üß† Estado Atual</h4>
                    
                    <label class="form-label required-field">Como est√° seu estado emocional atual?</label>
                    <textarea class="form-control" id="estadoAtual" rows="3" placeholder="Descreva como tem se sentido ultimamente..." required></textarea>
                    <div class="validation-error" id="estadoAtualError">Este campo √© obrigat√≥rio</div>
                    
                    <label class="form-label">J√° faz algum tratamento? Est√° estabilizado?</label>
                    <textarea class="form-control" id="estabilidadeTratamento" rows="3" placeholder="Informe se j√° faz tratamento e como est√°..."></textarea>
                    
                    <div class="button-group">
                        <button class="btn btn-back" onclick="previousStep()">Voltar</button>
                        <button class="btn btn-next" onclick="validateStep2()">Pr√≥ximo</button>
                    </div>
                </div>
                
                <!-- Passo 3: Sintomas -->
                <div class="form-step" id="step3">
                    <h4 class="mb-4" style="color: var(--dark-teal);">‚ö†Ô∏è Sintomas</h4>
                    
                    <label class="form-label">Sintomas Ansiosos (marque os que se aplicam)</label>
                    <div class="checkbox-group" id="sintomasAnsiososGroup">
                        ${sintomasAnsiososList.map((sintoma, index) => `
                            <label class="checkbox-item">
                                <input type="checkbox" name="sintomasAnsiosos" value="${sintoma}">
                                ${sintoma}
                            </label>
                        `).join('')}
                    </div>
                    
                    <label class="form-label">Sintomas Depressivos (marque os que se aplicam)</label>
                    <div class="checkbox-group" id="sintomasDepressivosGroup">
                        ${sintomasDepressivosList.map((sintoma, index) => `
                            <label class="checkbox-item">
                                <input type="checkbox" name="sintomasDepressivos" value="${sintoma}">
                                ${sintoma}
                            </label>
                        `).join('')}
                    </div>
                    
                    <label class="form-label">Altera√ß√µes de Humor (marque os que se aplicam)</label>
                    <div class="checkbox-group" id="sintomasHumorGroup">
                        ${sintomasHumorList.map((sintoma, index) => `
                            <label class="checkbox-item">
                                <input type="checkbox" name="sintomasHumor" value="${sintoma}">
                                ${sintoma}
                            </label>
                        `).join('')}
                    </div>
                    
                    <label class="form-label required-field">Tem tido pensamentos sobre morte ou suic√≠dio?</label>
                    <select class="form-select" id="pensamentosMorte" required>
                        <option value="">Selecione...</option>
                        <option value="N√£o">N√£o</option>
                        <option value="Pensamentos passageiros">Pensamentos passageiros</option>
                        <option value="Pensamentos frequentes">Pensamentos frequentes</option>
                        <option value="Planejamento">Com algum planejamento</option>
                    </select>
                    <div class="validation-error" id="pensamentosMorteError">Este campo √© obrigat√≥rio</div>
                    
                    <label class="form-label required-field">Como est√° sua percep√ß√£o da realidade?</label>
                    <select class="form-select" id="percepRealidade" required>
                        <option value="">Selecione...</option>
                        <option value="Normal">Normal, sem altera√ß√µes</option>
                        <option value="Leves altera√ß√µes">Leves altera√ß√µes</option>
                        <option value="Alucina√ß√µes">Com alucina√ß√µes</option>
                        <option value="Del√≠rios">Com del√≠rios</option>
                    </select>
                    <div class="validation-error" id="percepRealidadeError">Este campo √© obrigat√≥rio</div>
                    
                    <div class="button-group">
                        <button class="btn btn-back" onclick="previousStep()">Voltar</button>
                        <button class="btn btn-next" onclick="validateStep3()">Pr√≥ximo</button>
                    </div>
                </div>
                
                <!-- Passo 4: Hist√≥rico -->
                <div class="form-step" id="step4">
                    <h4 class="mb-4" style="color: var(--dark-teal);">üìã Hist√≥rico</h4>
                    
                    <label class="form-label required-field">Qual √© a queixa principal que o traz √† consulta?</label>
                    <textarea class="form-control" id="queixaPrincipal" rows="3" placeholder="Descreva o motivo principal da consulta..." required></textarea>
                    <div class="validation-error" id="queixaPrincipalError">Este campo √© obrigat√≥rio</div>
                    
                    <label class="form-label">Hist√≥rico psiqui√°trico anterior</label>
                    <textarea class="form-control" id="historicoPsiquiatrico" rows="3" placeholder="J√° fez tratamento antes? Tem diagn√≥stico pr√©vio?"></textarea>
                    
                    <label class="form-label">Medica√ß√£o atual (se houver)</label>
                    <textarea class="form-control" id="medicacaoAtual" rows="2" placeholder="Liste medica√ß√µes que est√° tomando atualmente..."></textarea>
                    
                    <label class="form-label">Comorbidades (outras condi√ß√µes de sa√∫de)</label>
                    <textarea class="form-control" id="comorbidades" rows="2" placeholder="Ex: diabetes, hipertens√£o, etc..."></textarea>
                    
                    <div class="button-group">
                        <button class="btn btn-back" onclick="previousStep()">Voltar</button>
                        <button class="btn btn-next" onclick="validateStep4()">Pr√≥ximo</button>
                    </div>
                </div>
                
                <!-- Passo 5: Resumo e Confirma√ß√£o -->
                <div class="form-step" id="step5">
                    <h4 class="mb-4" style="color: var(--dark-teal);">‚úÖ Resumo do Pedido</h4>
                    
                    <div class="order-summary">
                        <div class="summary-item">
                            <span>Servi√ßo selecionado:</span>
                            <span><strong>${selectedService.nome}</strong></span>
                        </div>
                        <div class="summary-item">
                            <span>Valor:</span>
                            <span><strong style="color: var(--dark-teal);">R$ ${selectedService.valor}</strong></span>
                        </div>
                        <div class="summary-total">
                            <span>Total a pagar:</span>
                            <span>R$ ${selectedService.valor}</span>
                        </div>
                    </div>
                    
                    <div class="alert alert-info">
                        <p><strong>üìã Resumo das informa√ß√µes:</strong></p>
                        <p id="resumoDados" style="font-size: 0.9rem; margin-bottom: 0;"></p>
                    </div>
                    
                    <div class="alert alert-warning">
                        <p><strong>‚ö†Ô∏è IMPORTANTE:</strong></p>
                        <p>1. Clique no bot√£o abaixo para enviar via WhatsApp</p>
                        <p>2. Eu receberei seus dados e enviarei o link para pagamento</p>
                        <p>3. Ap√≥s confirma√ß√£o do pagamento, agendaremos a consulta</p>
                    </div>
                    
                    <div class="whatsapp-loading" id="whatsappLoading">
                        <div class="spinner-border text-success" role="status">
                            <span class="visually-hidden">Carregando...</span>
                        </div>
                        <p class="mt-2">Preparando mensagem para WhatsApp...</p>
                    </div>
                    
                    <div class="whatsapp-fallback" id="whatsappFallback">
                        <p class="text-muted">Se o WhatsApp n√£o abrir automaticamente, clique abaixo:</p>
                        <a id="whatsappFallbackLink" href="#" target="_blank" class="btn btn-whatsapp w-100">
                            <i class="fab fa-whatsapp me-2"></i> Abrir WhatsApp Manualmente
                        </a>
                    </div>
                    
                    <div class="button-group">
                        <button class="btn btn-back" onclick="previousStep()">Voltar</button>
                        <button class="btn btn-whatsapp" onclick="sendToWhatsApp()">
                            <i class="fab fa-whatsapp me-2"></i> Enviar para WhatsApp
                        </button>
                    </div>
                </div>
            `;
        }

        // =============================
        // FUN√á√ïES DE VALIDA√á√ÉO
        // =============================
        function validateStep1() {
            let valid = true;
            
            const nome = document.getElementById('nome');
            const idade = document.getElementById('idade');
            const telefone = document.getElementById('telefone');
            const email = document.getElementById('email');
            
            // Validar nome
            if (!nome.value.trim()) {
                showError('nomeError', true);
                nome.classList.add('field-invalid');
                valid = false;
            } else {
                showError('nomeError', false);
                nome.classList.remove('field-invalid');
                formData.nome = nome.value.trim();
            }
            
            // Validar idade
            if (!idade.value || idade.value < 1 || idade.value > 120) {
                showError('idadeError', true);
                idade.classList.add('field-invalid');
                valid = false;
            } else {
                showError('idadeError', false);
                idade.classList.remove('field-invalid');
                formData.idade = idade.value;
            }
            
            // Validar telefone
            const phoneRegex = /^\(?\d{2}\)?[\s-]?\d{4,5}-?\d{4}$/;
            if (!telefone.value.trim() || !phoneRegex.test(telefone.value.replace(/\s/g, ''))) {
                showError('telefoneError', true);
                telefone.classList.add('field-invalid');
                valid = false;
            } else {
                showError('telefoneError', false);
                telefone.classList.remove('field-invalid');
                formData.telefone = telefone.value.trim();
            }
            
            // Validar email
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!email.value.trim() || !emailRegex.test(email.value)) {
                showError('emailError', true);
                email.classList.add('field-invalid');
                valid = false;
            } else {
                showError('emailError', false);
                email.classList.remove('field-invalid');
                formData.email = email.value.trim();
            }
            
            if (valid) {
                showStep(2);
            } else {
                // Scroll para o primeiro erro
                const firstError = document.querySelector('.field-invalid');
                if (firstError) {
                    firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        }

        function validateStep2() {
            const estadoAtual = document.getElementById('estadoAtual');
            
            if (!estadoAtual.value.trim()) {
                showError('estadoAtualError', true);
                estadoAtual.classList.add('field-invalid');
                estadoAtual.scrollIntoView({ behavior: 'smooth', block: 'center' });
                return;
            }
            
            showError('estadoAtualError', false);
            estadoAtual.classList.remove('field-invalid');
            
            formData.estadoAtual = estadoAtual.value.trim();
            formData.estabilidadeTratamento = document.getElementById('estabilidadeTratamento').value.trim();
            
            showStep(3);
        }

        function validateStep3() {
            const pensamentosMorte = document.getElementById('pensamentosMorte');
            const percepRealidade = document.getElementById('percepRealidade');
            let valid = true;
            
            // Validar pensamentos de morte
            if (!pensamentosMorte.value) {
                showError('pensamentosMorteError', true);
                pensamentosMorte.classList.add('field-invalid');
                valid = false;
            } else {
                showError('pensamentosMorteError', false);
                pensamentosMorte.classList.remove('field-invalid');
                formData.pensamentosMorte = pensamentosMorte.value;
            }
            
            // Validar percep√ß√£o da realidade
            if (!percepRealidade.value) {
                showError('percepRealidadeError', true);
                percepRealidade.classList.add('field-invalid');
                valid = false;
            } else {
                showError('percepRealidadeError', false);
                percepRealidade.classList.remove('field-invalid');
                formData.percepRealidade = percepRealidade.value;
            }
            
            // Coletar sintomas
            formData.sintomasAnsiosos = Array.from(document.querySelectorAll('input[name="sintomasAnsiosos"]:checked')).map(cb => cb.value);
            formData.sintomasDepressivos = Array.from(document.querySelectorAll('input[name="sintomasDepressivos"]:checked')).map(cb => cb.value);
            formData.sintomasHumor = Array.from(document.querySelectorAll('input[name="sintomasHumor"]:checked')).map(cb => cb.value);
            
            if (valid) {
                showStep(4);
            } else {
                const firstError = document.querySelector('.field-invalid');
                if (firstError) {
                    firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        }

        function validateStep4() {
            const queixaPrincipal = document.getElementById('queixaPrincipal');
            
            if (!queixaPrincipal.value.trim()) {
                showError('queixaPrincipalError', true);
                queixaPrincipal.classList.add('field-invalid');
                queixaPrincipal.scrollIntoView({ behavior: 'smooth', block: 'center' });
                return;
            }
            
            showError('queixaPrincipalError', false);
            queixaPrincipal.classList.remove('field-invalid');
            
            formData.queixaPrincipal = queixaPrincipal.value.trim();
            formData.historicoPsiquiatrico = document.getElementById('historicoPsiquiatrico').value.trim();
            formData.medicacaoAtual = document.getElementById('medicacaoAtual').value.trim();
            formData.comorbidades = document.getElementById('comorbidades').value.trim();
            
            // Atualizar resumo
            updateSummary();
            showStep(5);
        }

        function showError(errorId, show) {
            const errorElement = document.getElementById(errorId);
            if (errorElement) {
                errorElement.style.display = show ? 'block' : 'none';
            }
        }

        function showStep(step) {
            // Atualizar passo atual
            currentStep = step;
            
            // Esconder todos os passos
            for (let i = 1; i <= totalSteps; i++) {
                const stepElement = document.getElementById('step' + i);
                if (stepElement) {
                    stepElement.classList.remove('active');
                }
            }
            
            // Mostrar passo atual
            const currentStepElement = document.getElementById('step' + step);
            if (currentStepElement) {
                currentStepElement.classList.add('active');
            }
            
            // Atualizar progresso
            const progressBar = document.getElementById('progressBar');
            if (progressBar) {
                progressBar.style.width = `${(step/totalSteps)*100}%`;
            }
            
            // Atualizar indicador
            const stepIndicator = document.getElementById('stepIndicator');
            if (stepIndicator) {
                stepIndicator.textContent = `Passo ${step} de ${totalSteps}`;
            }
            
            // Scroll para o topo do formul√°rio
            const formContainer = document.getElementById('form-container');
            if (formContainer) {
                formContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                showStep(currentStep - 1);
            }
        }

        function updateSummary() {
            const resumoElement = document.getElementById('resumoDados');
            if (resumoElement) {
                let resumo = '';
                resumo += `<strong>Nome:</strong> ${formData.nome || 'N√£o informado'}<br>`;
                resumo += `<strong>Idade:</strong> ${formData.idade || 'N√£o informada'}<br>`;
                resumo += `<strong>Telefone:</strong> ${formData.telefone || 'N√£o informado'}<br>`;
                resumo += `<strong>E-mail:</strong> ${formData.email || 'N√£o informado'}<br>`;
                resumo += `<strong>Queixa principal:</strong> ${formData.queixaPrincipal ? formData.queixaPrincipal.substring(0, 100) + '...' : 'N√£o informada'}<br>`;
                resumo += `<strong>Pensamentos de morte:</strong> ${formData.pensamentosMorte || 'N√£o informado'}`;
                
                resumoElement.innerHTML = resumo;
            }
        }

        function sendToWhatsApp() {
            // Mostrar loading
            const loadingElement = document.getElementById('whatsappLoading');
            const fallbackElement = document.getElementById('whatsappFallback');
            
            if (loadingElement) loadingElement.style.display = 'block';
            if (fallbackElement) fallbackElement.style.display = 'none';
            
            // Construir mensagem
            let message = `*NOVA SOLICITA√á√ÉO DE CONSULTA*%0A%0A`;
            message += `*Servi√ßo:* ${selectedService.nome}%0A`;
            message += `*Valor:* R$ ${selectedService.valor}%0A%0A`;
            
            message += `*DADOS PESSOAIS*%0A`;
            message += `Nome: ${formData.nome}%0A`;
            message += `Idade: ${formData.idade}%0A`;
            message += `Telefone: ${formData.telefone}%0A`;
            message += `E-mail: ${formData.email}%0A%0A`;
            
            message += `*ESTADO ATUAL*%0A`;
            message += `${formData.estadoAtual}%0A`;
            if (formData.estabilidadeTratamento) {
                message += `Tratamento atual: ${formData.estabilidadeTratamento}%0A`;
            }
            message += `%0A`;
            
            message += `*SINTOMAS*%0A`;
            if (formData.sintomasAnsiosos.length > 0) {
                message += `Ansiosos: ${formData.sintomasAnsiosos.join(', ')}%0A`;
            }
            if (formData.sintomasDepressivos.length > 0) {
                message += `Depressivos: ${formData.sintomasDepressivos.join(', ')}%0A`;
            }
            if (formData.sintomasHumor.length > 0) {
                message += `Humor: ${formData.sintomasHumor.join(', ')}%0A`;
            }
            message += `Pensamentos morte: ${formData.pensamentosMorte}%0A`;
            message += `Percep√ß√£o realidade: ${formData.percepRealidade}%0A%0A`;
            
            message += `*QUEIXA PRINCIPAL*%0A`;
            message += `${formData.queixaPrincipal}%0A%0A`;
            
            if (formData.historicoPsiquiatrico) {
                message += `*HIST√ìRICO*%0A`;
                message += `${formData.historicoPsiquiatrico}%0A%0A`;
            }
            
            if (formData.medicacaoAtual) {
                message += `*MEDICA√á√ÉO ATUAL*%0A`;
                message += `${formData.medicacaoAtual}%0A%0A`;
            }
            
            if (formData.comorbidades) {
                message += `*COMORBIDADES*%0A`;
                message += `${formData.comorbidades}%0A%0A`;
            }
            
            message += `---%0A`;
            message += `Enviado via App de Anamnese Psiqui√°trica`;
            
            // Criar URL do WhatsApp
            const whatsappNumber = '554491339060';
            const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${message}`;
            
            // Configurar fallback
            const fallbackLink = document.getElementById('whatsappFallbackLink');
            if (fallbackLink) {
                fallbackLink.href = whatsappUrl;
            }
            
            // Abrir WhatsApp ap√≥s breve delay
            setTimeout(() => {
                if (loadingElement) loadingElement.style.display = 'none';
                if (fallbackElement) fallbackElement.style.display = 'block';
                
                window.open(whatsappUrl, '_blank');
                
                // Mostrar confirma√ß√£o
                alert('‚úÖ Mensagem preparada! O WhatsApp ser√° aberto para envio. Se n√£o abrir automaticamente, use o bot√£o "Abrir WhatsApp Manualmente".');
            }, 1500);
        }

        // =============================
        // INICIALIZA√á√ÉO
        // =============================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('‚úÖ DOM carregado');
            
            // Verificar imagens
            const images = document.querySelectorAll('img');
            images.forEach(img => {
                img.onerror = function() {
                    console.error('‚ùå Falha ao carregar imagem:', this.src);
                };
            });
        });

        // Verificar Service Worker ap√≥s carregamento
        setTimeout(() => {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(registrations => {
                    console.log('üìã Service Workers registrados:', registrations.length);
                    registrations.forEach(reg => {
                        console.log('üîß Scope:', reg.scope, 'Estado:', reg.active ? 'Ativo' : 'Inativo');
                    });
                });
            }
        }, 2000);
    </script>
</body>
</html>
